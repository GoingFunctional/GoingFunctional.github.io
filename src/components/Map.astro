---
import "leaflet/dist/leaflet.css";
---

<div id="map"></div>

<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin="anonymous"
  defer></script>

<script is:inline>
  const municipalities = [
    { name: "Stockholm", lat: 59.3293, lng: 18.0686 },
    { name: "Göteborg", lat: 57.7089, lng: 11.9746 },
    { name: "Malmö", lat: 55.605, lng: 13.0038 },
    { name: "Umeå", lat: 63.8258, lng: 20.263 },
  ];

  window.addEventListener("DOMContentLoaded", async () => {
    const map = L.map("map").setView([62.0, 15.0], 5);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution:
        '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);

    const res = await fetch("/data/municipalities.geojson");
    const geojson = await res.json();
    const layer = L.geoJSON(geojson, {
      style: () => ({
        color: "#aaaaaa", // border color
        weight: 3, // <<<<<< wider line (default is 1)
        opacity: 1, // border opacity
        fillColor: "#66aaff", // fill color
        fillOpacity: 0.1, // transparent fill
      }),
      onEachFeature: (feature, layer) => {
        const name = feature.properties?.shapeName ?? "Municipality";
        layer.bindPopup(`<strong>${name}</strong>`);
      },
    }).addTo(map);

    const cities = JSON.parse(`${JSON.stringify(municipalities)}`);
    cities.forEach(({ name, lat, lng }) => {
      const marker = L.marker([lat, lng]).bindPopup(`<b>${name}</b>`);
      //marker.addTo(map);
    });

    const muni_centers = await fetch("/data/municipality_centers.geojson");
    const centers = await muni_centers.json();
    L.geoJSON(centers, {
      pointToLayer: (f, latlng) => L.marker(latlng),
      onEachFeature: (f, layer) => layer.bindPopup(f.properties.name),
    });
    //.addTo(map);

    map.fitBounds(layer.getBounds(), { padding: [20, 20] });
  });
</script>

<style>
  #map {
    height: 70vh;
    width: 100%;
    max-width: 60rem;
  }
  .legend {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }
</style>
